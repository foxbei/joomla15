/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.BrowseTags=new Class({Implements:[Options],initialize:function(a){this.setOptions({msgSave:"Save",msgCancel:"Cancel"},a);var b=this;$$("span.edit-tag").each(function(d){d.getElement("a").addEvent("click",function(){b.removePanel();this.setStyle("display","none");var c=(new Element("span",{"class":"edit-tag-panel"})).injectAfter(this),f=(new Element("input",{"class":"text",type:"text",name:"new",value:this.get("text")})).injectInside(c);(new Element("input",{type:"hidden",name:"old",value:this.get("text")})).injectInside(c);
var g=(new Element("button",{"class":"save"})).set("text",b.options.msgSave).injectInside(c);c=(new Element("a",{"class":"cancel"})).set("text",b.options.msgCancel).injectInside(c);f.focus();f.addEvent("keydown",function(e){e=new Event(e);if(e.key=="enter"){e.stop();b.submit()}if(e.key=="esc"){e.stop();b.dispose()}});g.addEvent("click",b.submit);c.addEvent("click",b.removePanel)})})},removePanel:function(){$$("span.edit-tag-panel").each(function(a){a.getParent().getElement("a").setStyle("display",
"");a.dispose()})},submit:function(){var a=$("tags-default");a.getElement('input[name="task"]').setProperty("value","update");a.submit()}});
Zoo.Tag=new Class({Implements:[Options],initialize:function(a){this.setOptions({url:"index.php?option=com_zoo&controller=item"},a);this.tagCompleter=null;this.tagArea=$("tag-area");this.tagInput=this.tagArea.getElement('input[type="text"]');this.attachEvents();this.attachTagCompleter();this.indicator=this.tagArea.getElement("div.icon")},attachEvents:function(){var a=this;this.tagArea.getElement("div.hint").addEvent("click",function(){a.tagInput.focus()});this.tagArea.getElements("div.tag-list a").each(function(b){b.addEvent("click",
function(){b.getParent().dispose()})});this.tagArea.getElement("button").addEvent("click",function(b){(new Event(b)).stop();a.pressAddButton()});this.tagInput.addEvent("focus",function(){a.tagArea.getElement("div.hint").setStyle("display","none")});this.tagInput.addEvent("blur",function(){this.get("value")||a.tagArea.getElement("div.hint").setStyle("display",null)});this.tagInput.addEvent("keypress",function(b){b=new Event(b);if((!a.tagCompleter.selected||!a.tagCompleter.visible)&&b.key=="enter"){a.pressAddButton();
b.stop()}});this.tagArea.getElements("div.tag-cloud a").each(function(b){b.addEvent("click",function(){a.addTag(this.get("text"))})})},pressAddButton:function(){var a=this;tags=a.tagInput.get("value").split(",");tags.each(function(b){b=b.trim();a.addTag(b);a.tagInput.set("value","")})},attachTagCompleter:function(){var a=this;this.tagCompleter=new Autocompleter.Request.JSON(a.tagInput,this.options.url+"&format=raw&task=loadtags",{postVar:"tag",multiple:true,onRequest:function(){a.indicator.addClass("loader")},
onComplete:function(){a.indicator.removeClass("loader")}})},addTag:function(a){a=a.replace(/\./gi,"_");if(!this.tagExists(a)&&a!=""){var b=new Element("div"),d=new Element("a"),c=new Element("input",{type:"hidden",value:a,name:"tags[]"});b.set("text",a);d.injectTop(b);d.addEvent("click",function(){b.dispose()});c.injectInside(b);b.injectInside(this.tagArea.getElement("div.tag-list"))}},tagExists:function(a){var b=false;this.tagArea.getElements('input[name^="tags"]').each(function(d){if(a==d.get("value"))b=
true});return b}});
