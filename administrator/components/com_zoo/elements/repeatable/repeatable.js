/* Copyright (C) 2007 - 2011 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

(function(b){var d=function(){};b.extend(d.prototype,{name:"ElementRepeatable",options:{msgDeleteElement:null,msgSortElement:null},initialize:function(c,e){this.options=b.extend({},this.options,e);var f=this,a=c.find("ul.repeatable-list"),i=a.find("li.hidden").remove(),j=a.find("li.repeatable-element").length;a.find("li.repeatable-element").each(function(){f.attachButtons(b(this))});a.delegate("span.sort","mousedown",function(){a.find(".more-options.show-advanced").removeClass("show-advanced");a.css("height",
a.css("height","").height())}).delegate("span.delete","click",function(){b(this).closest("li.repeatable-element").fadeOut(200,function(){b(this).remove();a.css("height",a.css("height","").height())})}).sortable({handle:"span.sort",placeholder:"repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:false,start:function(h,g){g.item.addClass("ghost");g.placeholder.height(g.item.height()-2);g.placeholder.width(g.item.find("div.repeatable-content").width()-
2)},stop:function(h,g){g.item.removeClass("ghost")}});c.find("p.add a").bind("click",function(){var h=b("<li>").addClass("repeatable-element").html(i.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+j++ +"]"));f.attachButtons(h);h.appendTo(a);h.find("input").each(function(){b(this).val()&&b(this).val("")});h.children("div.repeatable-content").effect("highlight",{},1E3);a.css("height",a.css("height","").height())});a.css("height",a.height())},attachButtons:function(c){c.children().wrapAll(b("<div>").addClass("repeatable-content"));
b("<span>").addClass("sort").attr("title",this.options.msgSortElement).appendTo(c);b("<span>").addClass("delete").attr("title",this.options.msgDeleteElement).appendTo(c)}});b.fn[d.prototype.name]=function(){var c=arguments,e=c[0]?c[0]:null;return this.each(function(){var f=b(this);if(d.prototype[e]&&f.data(d.prototype.name)&&e!="initialize")f.data(d.prototype.name)[e].apply(f.data(d.prototype.name),Array.prototype.slice.call(c,1));else if(!e||b.isPlainObject(e)){var a=new d;d.prototype.initialize&&
a.initialize.apply(a,b.merge([f],c));f.data(d.prototype.name,a)}else b.error("Method "+e+" does not exist on jQuery."+d.name)})}})(jQuery);
