/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.BrowseCategories=new Class({Implements:[Options],initialize:function(a){this.setOptions({url:"index.php"},a);this.oldParent=null;if($("categories"))this.tree=new SortableTree("categories",{handle:".handle",onBeforeDrop:this.beforeDrop.bind(this),onAfterDrop:this.afterDrop.bind(this),onComplete:this.save.bind(this)})},beforeDrop:function(a){this.oldParent=a.getParent()},afterDrop:function(a,b,d){var c=null;switch(d){case "top":case "bottom":a.getElement("input[name^=parent]").set("value",b.getElement("input[name^=parent]").get("value"));
c=b.getParent();break;case "insert":a.getElement("input[name^=parent]").set("value",b.getElement("input[name^=category]").get("value"));c=a.getParent()}this.updateOrdering(c);this.updateOrdering(this.oldParent)},updateOrdering:function(a){var b=this.tree,d=1;a.getChildren().each(function(c){c!=b.clone&&c.getElement("input[name^=ordering]").setProperty("value",d++)})},save:function(a){var b=new Hash;$("categories-default").getElements("input[name^=parent], input[name^=ordering], input[type=hidden]").each(function(d){var c=
d.name,e=d.get("value");e===false||!c||d.disabled||b.set(c,e)});(new Request.JSON({url:this.options.url,data:(new Hash({task:"saveorder",format:"raw"})).combine(b),onRequest:function(){a.addClass("loader")},onComplete:function(d,c){a.removeClass("loader");Message.show(c,true)}})).post()}});
Zoo.EditCategory=new Class({initialize:function(){var a=this;["apply","save"].each(function(b){$("toolbar-"+b).getElement("a").removeProperty("onclick").addEvent("click",function(){a.submit(b)})})},submit:function(a){$("name-edit").getElement('input[name="name"]').get("value")==""?$("name-edit").getElement("span.message-name").setStyle("display","inline"):submitbutton(a)}});
