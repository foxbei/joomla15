/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.Comment=new Class({Implements:[Events,Options],initialize:function(a){this.setOptions({url:"index.php?option=com_zoo&controller=comment",id:"edit-comment-editor"},a);this.form=$("comments-default");this.form.getElements("tr.comment-row").each(function(b){this.attachEvents(b)}.bind(this))},attachEvents:function(a){a.getElement(".actions-links .edit").addEvent("click",function(c){(new Event(c)).stop();this.editEvent(a)}.bind(this));a.getElement(".actions-links .reply").addEvent("click",function(c){(new Event(c)).stop();
this.replyEvent(a)}.bind(this));a.getElement(".actions-links .delete a").addEvent("click",function(c){(new Event(c)).stop();this.stateEvent(a,"remove")}.bind(this));var b=a.getElement(".actions-links .approve a"),d=a.getElement(".actions-links .unapprove a"),e=a.getElement(".actions-links .spam a"),f=a.getElement(".actions-links .no-spam a");b&&b.addEvent("click",function(c){(new Event(c)).stop();this.stateEvent(a,"approve")}.bind(this));d&&d.addEvent("click",function(c){(new Event(c)).stop();this.stateEvent(a,
"unapprove")}.bind(this));e&&e.addEvent("click",function(c){(new Event(c)).stop();this.stateEvent(a,"spam")}.bind(this));f&&f.addEvent("click",function(c){(new Event(c)).stop();this.stateEvent(a,"approve")}.bind(this))},editEvent:function(a){var b=this,d=a.getElement("input[name^=cid]").getProperty("value");(new Request.HTML({url:b.options.url,data:"task=edit&format=raw&cid="+d,onComplete:function(e){b.removeEditor();b.insertEditor(a,e);a.setStyle("display","none");b.form.removeEvents();b.form.addEvents({save:function(f,
c){if(JSON.decode(c,true))Message.show(c);else{var g=(new Element("table")).set("html",c).getElement("tr");b.removeEditor();b.attachEvents(g);g.replaces(f);b.stripe()}},cancel:function(){b.removeEditor()}})}})).post()},replyEvent:function(a){var b=this,d=a.getElement("input[name^=cid]").getProperty("value");(new Request.HTML({url:b.options.url,data:"task=reply&format=raw&cid="+d,onComplete:function(e){b.removeEditor();b.insertEditor(a,e);b.form.removeEvents();b.form.addEvents({save:function(f,c){if(JSON.decode(c,
true))Message.show(c);else{var g=(new Element("table")).set("html",c).getElement("tr");b.removeEditor();b.attachEvents(g);g.injectAfter(f);b.stripe()}},cancel:function(){b.removeEditor()}})}})).post()},stateEvent:function(a,b){var d=a.getElement("input[name^=cid]").getProperty("value");(new Element("input",{type:"hidden",name:"cid",value:d})).injectInside(this.form);this.form.getElement("input[name=task]").setProperty("value",b);this.form.submit()},insertEditor:function(a,b){var d=this,e=(new Element("tr",
{id:this.options.id})).injectAfter(a);(new Element("td",{colspan:"4"})).empty().adopt(b).injectInside(e);e.getElement(".content textarea").focus();e.getElement(".actions .save").addEvent("click",function(f){(new Event(f)).stop();var c=new Hash;d.form.getElements("input, textarea").each(function(g){var i=g.name,h=g.get("value");h===false||!i||g.disabled||c.set(i,h)});(new Request.HTML({url:d.options.url,data:(new Hash({task:"save",format:"raw"})).combine(c),onComplete:function(g,i,h){d.form.fireEvent("save",
[a,h])}})).post()});e.getElement(".actions .cancel").addEvent("click",function(f){(new Event(f)).stop();d.form.fireEvent("cancel")})},removeEditor:function(){var a=$(this.options.id);if(a){a.getPrevious().setStyle("display","");a.dispose()}},stripe:function(){$$("table.stripe tbody tr").each(function(a,b){a.removeClass("even");a.removeClass("odd");a.addClass(b%2?"even":"odd")})}});
