/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.EditElements=new Class({Implements:[Options],initialize:function(a){this.setOptions({url:"index.php?option=com_zoo&controller=manager",msgNoElements:"No elements defined for this type",msgDeletelog:"Are you sure you want to delete the element?"},a);this.list=$("element-list");this.count=0;this.noElements();this.attachEvents()},attachEvents:function(){var a=this;this.list.getElements("div.edit-event").each(function(b){b.addEvent("click",function(){a.editElement(b)})});this.list.getElements("div.delete-event").each(function(b){b.addEvent("click",
function(){a.deleteElement(b)})});$("add-element").getElements("ul.elements li").each(function(b){b.addEvent("click",function(){a.addElement(b.getProperty("class"),a.count++)})});this.sort=new Sortables(this.list,{handle:"div.sort-event",clone:true,opacity:0.5,revert:true,constrain:true,onStart:function(b,c){a.preserveState();var d=b.getCoordinates();b.addClass("dragging");c.addClass("hideconfig");c.setStyles({"background-color":"#ffffff",width:d.width-22,opacity:1,"z-index":99})},onComplete:function(b){a.recoverState();
b.removeClass("dragging");a.orderElements()}})},addElement:function(a,b){var c=this,d=new Element("li",{"class":"element"});(new Request.HTML({url:this.options.url+"&format=raw&task=addelement",data:"element="+a+"&count="+b,evalScripts:true,update:d,onRequest:function(){d.addClass("loading");d.injectTop(c.list)},onSuccess:function(){d.removeClass("loading");c.noElements();c.orderElements();c.sort.addItems(d);d.getElements("div.edit-event").each(function(f){f.addEvent("click",function(){c.editElement(f)})});
d.getElements("div.delete-event").each(function(f){f.addEvent("click",function(){c.deleteElement(f)})});new Tips(d.getElements(".hasTip"),{maxTitleChars:50,fixed:false});var e=d.getCoordinates();d.set("styles",{height:0,opacity:0});(new Fx.Morph(d,{duration:200,transition:Fx.Transitions.linear})).start({height:e.height-22,opacity:1}).chain(function(){d.set("styles",{height:"auto",opacity:1});c.highlight(d)})}})).post()},editElement:function(a){a.getParent().toggleClass("hideconfig")},deleteElement:function(a){if(confirm(this.options.msgDeletelog)){var b=
this,c=a.getParent();(new Fx.Morph(c,{duration:200,transition:Fx.Transitions.linear})).start({height:0,opacity:0}).chain(function(){c.dispose();b.noElements();b.orderElements()})}},orderElements:function(){this.list.getElements("input[name*=ordering]").each(function(a,b){a.setProperty("value",b)})},noElements:function(){var a=this.list.getElements("li"),b=this.list.getElements("li.no-elements");if(a.length==0)(new Element("li",{"class":"no-elements"})).set("html",this.options.msgNoElements).injectTop(this.list);
else a.length>1&&b.length==1&&b.each(function(c){c.dispose()})},preserveState:function(){$$("#element-list li.element").each(function(a){if(!a.hasClass("hideconfig")){a.addClass("hideconfig");a._showconfig=true}})},recoverState:function(){$$("#element-list li.element").each(function(a){if(a._showconfig){a.removeClass("hideconfig");a._showconfig=false}})},highlight:function(a){(new Fx.Morph(a,{duration:100,transition:Fx.Transitions.linear})).start({"background-color":"#ffffaa"}).chain(function(){this.setOptions({duration:700});
this.start({"background-color":"#ffffff"})}).chain(function(){a.removeProperty("style")})}});
Zoo.AssignElements=new Class({initialize:function(){var a=this;this.sortlist=new Sortables(null,{handle:"div.sort-event",opacity:0.5,revert:true,clone:true,onStart:function(b,c){if($unassigned=a.sortlist.list.getProperty("role")=="unassigned"){var d=b.clone();d.setStyle("opacity",1);a.attachEvents(d);a.sortlist.addItems(d);b.setStyle("display","none")}b.getElements("input[name^=elements], textarea[name^=elements]").each(function(e){e.setProperty("name",e.getProperty("name").replace(/(elements)\[[a-z0-9_-]+\]/i,
"$1[dragging]"))});$unassigned&&d.injectAfter(b);b.addClass("dragging");c.setStyle("z-index",10)},onSort:function(b,c){b.getParent().getProperty("role")=="unassigned"?b.setStyle("display","none"):b.setStyle("display","block");a.sortlist.lists.each(function(d){a.emptyList(d,c)})},onComplete:function(b){b.removeClass("dragging");a.sanatizeList()}});$$("ul.element-list").each(function(b){a.sortlist.addLists(b);a.emptyList(b)});$$("li.element").each(function(b){a.attachEvents(b)});this.sanatizeList()},
emptyList:function(a,b){var c=a.getChildren();if(c.contains(b)&&c.length==1)a.addClass("empty-list");else c.length==0?a.addClass("empty-list"):a.removeClass("empty-list")},attachEvents:function(a){var b=this;a.getElement("div.edit-event").addEvent("click",function(){a.toggleClass("hideconfig")});a.getElement("div.delete-event").addEvent("click",function(){(new Fx.Morph(a,{duration:200,transition:Fx.Transitions.linear})).start({height:0,opacity:0}).chain(function(){b.emptyList(a.getParent(),a);a.dispose()})})},
sanatizeList:function(){var a="";this.sortlist.lists.each(function(b){if(b.getProperty("role")!="unassigned"){a="positions["+b.getProperty("role")+"]";b.getChildren().each(function(c,d){$(c).getElements("input[name^=elements], textarea[name^=elements], select[name^=elements], input[name^=positions], textarea[name^=positions], select[name^=positions]").each(function(e){e.setProperty("name","tmp"+e.getProperty("name").replace(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/i,a+"["+d+
"]"))})})}});$("assign-elements").getElements("input[name^=tmp], textarea[name^=tmp], select[name^=tmp]").each(function(b){b.setProperty("name",b.getProperty("name").replace(/^tmp/,""))})}});
Zoo.AssignSubmission=new Class({initialize:function(){var a=this;this.sortlist=new Sortables(null,{handle:"div.sort-event",opacity:0.5,revert:true,clone:true,onStart:function(b,c){b.addClass("dragging");c.setStyle("z-index",10)},onSort:function(b,c){b.getParent().getProperty("role")=="unassigned"&&b.addClass("hideconfig");a.sortlist.lists.each(function(d){a.emptyList(d,c)})},onComplete:function(b){b.removeClass("dragging");a.sanatizeList()}});$$("ul.element-list").each(function(b){a.sortlist.addLists(b);
a.emptyList(b)});$$("li.element").each(function(b){a.attachEvents(b)});this.sanatizeList()},attachEvents:function(a){var b=this;a.getElement("div.edit-event").addEvent("click",function(){a.toggleClass("hideconfig")});a.getElement("div.delete-event").addEvent("click",function(){b.sortlist.lists.each(function(c){if(c.getProperty("role")=="unassigned"){a.injectInside(c);a.addClass("hideconfig")}});b.sanatizeList();b.sortlist.lists.each(function(c){b.emptyList(c)})})},emptyList:function(a,b){var c=a.getChildren();
if(c.contains(b)&&c.length==1)a.addClass("empty-list");else c.length==0?a.addClass("empty-list"):a.removeClass("empty-list")},sanatizeList:function(){this.sortlist.lists.each(function(a){var b="positions["+a.getProperty("role")+"][";a.getChildren().each(function(c,d){$(c).getElements("input[name^=positions], textarea[name^=positions], select[name^=positions]").each(function(e){e.setProperty("name","tmp"+e.getProperty("name").replace(/^positions\[[a-z0-9_-]+\]\[[0-9]+\]*/i,b+d+"]"))})})});$("assign-elements").getElements("input[name^=tmp], textarea[name^=tmp], select[name^=tmp]").each(function(a){a.setProperty("name",
a.getProperty("name").replace(/^tmp/,""))})}});Zoo.EditType=new Class({initialize:function(){var a=this;["apply","save"].each(function(b){$("toolbar-"+b).getElement("a").removeProperty("onclick").addEvent("click",function(){a.submit(b)})})},submit:function(a){$("name-edit").getElement('input[name="name"]').get("value")==""?$("name-edit").getElement("span.message-name").setStyle("display","inline"):submitbutton(a+"type")}});
