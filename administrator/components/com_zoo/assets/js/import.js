/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.ImportExport=new Class({Implements:[Options],initialize:function(b){this.setOptions({msgImportWarning:"Please choose a file first!"},b);var a=this,c=$("configuration-importexport");c.getElements("div.uploadbox").each(function(d){var e=d.getElement("input.filename");d.getElement('input[name^="import-"]').addEvent("change",function(){e.set("value",this.value)});d.getElement("button.upload").addEvent("click",function(){e.get("value")==""?alert(a.options.msgImportWarning):submitbutton("import")})});
c.getElements("a.exporter-link").each(function(d){d.addEvent("click",function(){c.getElement('input[name="exporter"]').set("value",d.getProperty("id"));submitbutton("importfrom")})});(b=c.getElement("button.export"))&&b.addEvent("click",function(){var d=c.getElement('input[name="format"]');d.set("value","raw");c.getElement('input[name="exporter"]').set("value","zoo2");submitbutton("doexport");d.set("value","html")})}});
Zoo.Import=new Class({Implements:[Options],initialize:function(b){this.setOptions({msgSelectWarning:"You didn't assign all item types. Items of these types will not be imported. Do you want to proceed anyway?",msgWarningDuplicate:"There are duplicate assignments.",msgNameWarning:"Please choose a name column.",task:"doimport"},b);var a=this;this.form=$("configuration-import");(this.frontpage=this.form.getElement("fieldset.frontpage"))&&this.frontpage.getElement('input[name="import-frontpage"]').addEvent("change",
function(){if(a.frontpage.getElement("div.assign-group"))this.get("value")?a.frontpage.getElement("div.assign-group").setStyle("display",null):a.frontpage.getElement("div.assign-group").setStyle("display","none")});(this.categories=this.form.getElement("fieldset.categories"))&&this.categories.getElement('input[name="import-categories"]').addEvent("change",function(){if(a.categories.getElement("div.assign-group"))this.get("value")?a.categories.getElement("div.assign-group").setStyle("display",null):
a.categories.getElement("div.assign-group").setStyle("display","none")});this.form.getElements("fieldset.items").each(function(c){c.getElement("select.type").addEvent("change",function(){var d=this;c.getElements("li.assign").each(function(e){if(e=e.getElements("select.assign")){var g=RegExp("\\["+d.get("value")+"\\]$");e.each(function(f){f.setStyle("display",f.getProperty("name").match(g)?"block":"none")})}})})});$("submit-button").addEvent("click",function(){if(a.options.task!="doimportcsv"&&a.hasDuplicateSelectedAssignments())alert(a.options.msgWarningDuplicate);
else if(a.options.task=="doimportcsv"&&!a.hasNameAssigned())alert(a.options.msgNameWarning);else a.hasUnassignedTypes()&&!confirm(a.options.msgSelectWarning)||submitbutton(a.options.task)})},hasNameAssigned:function(){var b=this.form.getElements("div.assign-group");if(b)for(k=0;k<b.length;k++){var a=b[k].getElement("select.type");a=RegExp("\\["+a.get("value")+"\\]$");var c=b[k].getElements("select.assign");if(c)for(i=0;i<c.length;i++)if(c[i].getProperty("name").match(a)&&c[i].set("value","_name"))return true}return false},
hasUnassignedTypes:function(){var b=this.form.getElements("select.type");if(b)for(i=0;i<b.length;i++)if(b[i].get("value")=="")return true;return false},hasDuplicateSelectedAssignments:function(){var b=this.form.getElements("div.assign-group");if(b)for(k=0;k<b.length;k++){var a=b[k].getElements("select.assign");if(a)for(i=0;i<a.length;i++)for(j=i+1;j<a.length;j++)if(a[i].value!=""&&a[i].value!="_category"&&a[i].value==a[j].value)return true}return false}});
