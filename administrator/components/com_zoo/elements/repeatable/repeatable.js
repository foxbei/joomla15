/* Copyright (C) 2007 - 2010 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

Zoo.ElementRepeatable=new Class({Implements:[Options],initialize:function(a){this.setOptions({element:"",msgDeleteElement:null,msgSortElement:null},a);this.element=$(this.options.element);this.list=this.element.getElement("ul.repeatable-list");this.hidden=this.list.getElement("li.hidden").dispose();this.count=this.list.getElements("li.repeatable-element").length;this.list.getElements("li.repeatable-element").each(function(b){this.attachEvents(b)}.bind(this));this.sort=new Sortables(this.list,{handle:"span.sort",
clone:true,opacity:0.5,revert:true,constrain:true,onStart:function(b,c){b.addClass("dragging");c.addClass("ghost");c.setStyles({"background-color":"#ffffff","z-index":99});this.list.getElements("div.more-options").each(function(d){d.setProperty("class","more-options")})}.bind(this),onComplete:function(b){b.removeClass("dragging")}});this.element.getElement("p.add a").addEvent("click",function(){this.addElement()}.bind(this))},attachEvents:function(a){var b=new Element("div",{"class":"repeatable-content"});
a.getChildren().each(function(c){c.injectInside(b)});b.injectInside(a);(new Element("span",{"class":"sort",title:this.options.msgSortElement})).injectInside(a);(new Element("span",{"class":"delete",title:this.options.msgDeleteElement})).injectInside(a).addEvent("click",function(){this.deleteElement(a)}.bind(this))},addElement:function(){var a=(new Element("li",{"class":"repeatable-element"})).set("html",this.hidden.get("html").replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+this.count++ +"]"));this.attachEvents(a);
this.sort.addItems(a);a.injectInside(this.list);a.getElements("input").each(function(b){b.value&&b.set("value","")});a.getElements("script").each(function(b){eval(b.get("html"))});this.highlight(a.getElement("div.repeatable-content"))},deleteElement:function(a){this.sort&&this.sort.removeItems(a);(new Fx.Morph(a,{duration:200,transition:Fx.Transitions.linear})).start({height:0,opacity:0}).chain(function(){a.dispose()})},highlight:function(a){a.get("tween",{property:"background-color",duration:100,
transition:Fx.Transitions.linear}).start("#ffffaa").chain(function(){this.setOptions({duration:700});this.start("#ffffff")})}});
