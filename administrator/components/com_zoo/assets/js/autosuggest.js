/* Copyright (C) 2007 - 2011 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

(function(b){var f=function(){};b.extend(f.prototype,{name:"autosuggest",options:{prefill:"",allowDuplicates:true,inputName:"term[]",resultsHighlight:true,addButtonText:"Add"},initialize:function(a,d){this.options=b.extend({},this.options,d);var c=this;this.input=a;b.extend(b.expr[":"],{focus:function(e){return e==document.activeElement}});a.addClass("as-input").wrap('<ul class="as-selections">').wrap('<li class="as-original">').autocomplete(b.extend({select:function(e,g){c.addItem(g.item);g.item.value=
g.item.label=""}},this.options)).bind("blur",function(){c.selections_holder.addClass("blur").find("li.as-selection-item").removeClass("selected")}).bind("focus",function(){c.selections_holder.removeClass("blur")}).bind("keydown",function(e){switch(e.which){case 8:if(a.val()==""){e.preventDefault();li=b("li.as-selection-item:last");li.is(".selected")?c.removeItem(li):c.selectItem(li)}break;case 9:case 188:e.preventDefault();c.addItem(a.val())}});this.selections_holder=a.closest("ul.as-selections").bind("click",
function(){a.not(":focus")&&a.focus()});this.original=this.selections_holder.find("li.as-original");b('<li class="add-tag-button" >').insertAfter(this.original).text(this.options.addButtonText).bind("click",function(){b.each(a.val().split(","),function(e,g){c.addItem(g)})});typeof this.options.prefill=="string"?b.each(this.options.prefill.split(","),function(e,g){c.addItem(g)}):c.addItem(this.options.prefill);a.is(":focus")?a.focus():a.blur();this.selections_holder.delegate("a.as-close","click",function(){c.removeItem(b(this).parent())}).delegate("li.as-selection-item",
"click",function(){c.selectItem(this)})},addItem:function(a){if(typeof a=="string")a={label:a.trim(),value:a.trim()};if(a.value!=""&&(this.options.allowDuplicates||!this.itemExists(a))){var d=b('<li class="as-selection-item">').text(a.label).data("item",a).insertBefore(this.original);b('<a class="as-close">&times;</a>').appendTo(d);b('<input type="hidden" class="as-value">').attr("name",this.options.inputName).val(a.value).appendTo(d)}this.input.val("")},removeItem:function(a){a.remove()},itemExists:function(a){var d=
false;this.selections_holder.find("li.as-selection-item").each(function(){if(b(this).data("item")&&b(this).data("item").value.toLowerCase()==a.value.toLowerCase())d=true});return d},selectItem:function(a){b("li.as-selection-item",this.selections_holder).not(a).removeClass("selected");b(a).addClass("selected");this.input.not(":focus")&&this.input.focus()}});b.fn[f.prototype.name]=function(){var a=arguments,d=a[0]?a[0]:null;return this.each(function(){var c=b(this);if(f.prototype[d]&&c.data(f.prototype.name)&&
d!="initialize")c.data(f.prototype.name)[d].apply(c.data(f.prototype.name),Array.prototype.slice.call(a,1));else if(!d||b.isPlainObject(d)){var e=new f;f.prototype.initialize&&e.initialize.apply(e,b.merge([c],a));c.data(f.prototype.name,e)}else b.error("Method "+d+" does not exist on jQuery."+f.name)})}})(jQuery);
