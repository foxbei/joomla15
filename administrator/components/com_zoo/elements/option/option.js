/* Copyright (C) 2007 - 2011 YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

(function(a){var f=function(){};a.extend(f.prototype,{name:"ElementSelect",options:{element:null,variable:null},initialize:function(c,d){this.options=a.extend({},this.options,d);var b=this;this.element=c;this.list=c.children("ul");this.hidden=this.list.find("li.hidden").detach();c.delegate("div.delete","click",function(){a(this).parent("li").slideUp(400,function(){a(this).remove();b.orderOptions()})}).delegate("div.name-input input","blur",function(){var e=a(this).closest("li"),g=e.find("div.panel input:text");
if(a(this).val()!=""&&g.val()==""){var h=a.String.slugify(a(this).val());g.val(h);e.find("a.trigger").text(h)}}).delegate("div.panel input:text","keydown",function(e){e.stopPropagation();e.which==13&&b.setOptionValue(a(this).closest("li"));e.which==27&&b.removeOptionPanel(a(this).closest("li"))}).delegate("input.accept","click",function(){b.setOptionValue(a(this).closest("li"))}).delegate("a.cancel","click",function(){b.removeOptionPanel(a(this).closest("li"))}).delegate("a.trigger","click",function(){a(this).hide().closest("li").find("div.panel").addClass("active").find("input:text").focus()}).find("div.add").bind("click",
function(){b.hidden.clone().removeClass("hidden").appendTo(b.list).slideDown(200).effect("highlight",{},1E3);b.orderOptions()});this.list.sortable({handle:"div.sort-handle",containment:this.list.parent().parent(),placeholder:"dragging",axis:"y",opacity:1,revert:75,delay:100,tolerance:"pointer",zIndex:99,start:function(e,g){g.placeholder.height(g.helper.height());b.list.sortable("refreshPositions")},stop:function(){b.orderOptions()}})},setOptionValue:function(c){var d=c.find("div.panel input:text"),
b=a.String.slugify(d.val());if(b=="")b=(b=a.String.slugify(c.find("div.name-input input").val()))?b:"42";d.val(b);c.find("a.trigger").text(b);this.removeOptionPanel(c)},removeOptionPanel:function(c){c.find("div.panel input:text").val(c.find("a.trigger").show().text());c.find("div.panel").removeClass("active")},orderOptions:function(){var c=/^(\S+\[options\])\[\d+\](\[name\]|\[value\])$/;this.list.children("li").each(function(d){a(this).find("input").each(function(){a(this).attr("name",a(this).attr("name").replace(c,
"$1["+d+"]$2"))})})}});a.fn[f.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var b=a(this);if(f.prototype[d]&&b.data(f.prototype.name)&&d!="initialize")b.data(f.prototype.name)[d].apply(b.data(f.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var e=new f;f.prototype.initialize&&e.initialize.apply(e,a.merge([b],c));b.data(f.prototype.name,e)}else a.error("Method "+d+" does not exist on jQuery."+f.name)})}})(jQuery);
